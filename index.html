
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <title>All Requests</title>
</head>
<body>
<main layout:fragment="content">
    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title mb-3">Requests</h3>
            <div class="table-responsive">
                <table class="table table-striped align-middle">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>User</th>
                        <th>Course</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="r,iter : ${requests}">
                        <td th:text="${iter.index + 1}">1</td>
                        <td th:text="${r.userName}">John</td>
                        <td th:text="${r.courseName}">Java</td>
                        <td th:text="${r.phone}">+7...</td>
                        <td>
                            <span th:text="${r.handled} ? 'Processed' : 'Pending'"
                                  th:classappend="${r.handled} ? 'badge bg-success' : 'badge bg-warning text-dark'">Pending</span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <a th:href="@{'/requests/' + ${r.id}}" class="btn btn-sm btn-primary">Open</a>
                                <form th:action="@{'/requests/' + ${r.id} + '/process'}" method="post" th:if="${!r.handled}" class="d-inline">
                                    <input type="hidden" name="handled" value="true"/>
                                    <button class="btn btn-sm btn-success" type="submit">Process Request</button>
                                </form>
                                <form th:action="@{'/requests/' + ${r.id} + '/process'}" method="post" th:if="${r.handled}" class="d-inline">
                                    <input type="hidden" name="handled" value="false"/>
                                    <button class="btn btn-sm btn-secondary" type="submit">Mark Pending</button>
                                </form>
                                <form th:action="@{'/requests/' + ${r.id} + '/delete'}" method="post" class="d-inline" onsubmit="return confirm('Delete this request?');">
                                    <button class="btn btn-sm btn-danger" type="submit">Delete Application</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(requests)}">
                        <td colspan="6" class="text-center text-muted">No requests found.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>
</body>
</html>
